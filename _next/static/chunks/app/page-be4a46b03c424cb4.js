(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1801:function(e,t,a){Promise.resolve().then(a.bind(a,7564))},7564:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return R}});var n=a(7437),r=a(2265),l=()=>{let[e,t]=(0,r.useState)(null),[a,n]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let e=localStorage.getItem("gemini-api-key");e?t(e):n(!0)},[]),{apiKey:e,isApiKeyModalOpen:a,saveApiKey:e=>{localStorage.setItem("gemini-api-key",e),t(e),n(!1)},setApiKeyModalOpen:n}},s=a(3392),o=a(9507),i=a(7468),c=a(1327),d=a(9026),u=a(4013),h=e=>{let{open:t,onClose:a,onSave:l}=e,[h,x]=(0,r.useState)("");return(0,n.jsxs)(s.Z,{open:t,onClose:a,children:[(0,n.jsx)(o.Z,{children:"Enter Gemini API Key"}),(0,n.jsx)(i.Z,{children:(0,n.jsx)(c.Z,{autoFocus:!0,margin:"dense",id:"api-key",label:"API Key",type:"password",fullWidth:!0,variant:"standard",value:h,onChange:e=>x(e.target.value)})}),(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(u.Z,{onClick:a,children:"Cancel"}),(0,n.jsx)(u.Z,{onClick:()=>{l(h),a()},children:"Save"})]})]})},x=()=>{let[e,t]=(0,r.useState)([]),[a,n]=(0,r.useState)(null),[l,s]=(0,r.useState)({});return(0,r.useEffect)(()=>{let e=localStorage.getItem("characters");e&&t(JSON.parse(e));let a=localStorage.getItem("conversations");a&&s(JSON.parse(a))},[]),{characters:e,selectedCharacter:a,conversations:l,saveCharacter:a=>{let n=[...e,a];t(n),localStorage.setItem("characters",JSON.stringify(n))},selectCharacter:t=>{n(e.find(e=>e.id===t)||null)},saveMessages:(e,t)=>{let a={...l,[e]:t};s(a),localStorage.setItem("conversations",JSON.stringify(a))},resetConversation:e=>{let t={...l,[e]:[]};s(t),localStorage.setItem("conversations",JSON.stringify(t))},deleteCharacter:r=>{let o=e.filter(e=>e.id!==r);t(o),localStorage.setItem("characters",JSON.stringify(o));let i={...l};delete i[r],s(i),localStorage.setItem("conversations",JSON.stringify(i)),(null==a?void 0:a.id)===r&&n(null)}}},g=a(9360),m=a(5002),p=a(9034),j=a(1899),v=a(2574);a(3814);var y=e=>{let{open:t,onClose:a,onSave:l}=e,[h,x]=(0,r.useState)(""),[y,f]=(0,r.useState)(""),[b,Z]=(0,r.useState)(""),[C,k]=(0,r.useState)(""),[S,w]=(0,r.useState)(null),[I,P]=(0,r.useState)(),[N,E]=(0,r.useState)(null),O=(0,r.useRef)(null),R=(e,t)=>{let a=document.createElement("canvas"),n=e.naturalWidth/e.width,r=e.naturalHeight/e.height;a.width=t.width,a.height=t.height;let l=a.getContext("2d");return l&&l.drawImage(e,t.x*n,t.y*r,t.width*n,t.height*r,0,0,t.width,t.height),new Promise(e=>{e(a.toDataURL("image/jpeg",.8))})},W=async()=>{let e=S;N&&O.current&&(e=await R(O.current,N)),l({id:(0,g.Z)(),name:h,personality:y,interests:b,backstory:C,profilePicture:e||void 0,backgroundImage:S||void 0}),a(),x(""),f(""),Z(""),k(""),w(null),P(void 0),E(null)};return(0,n.jsxs)(s.Z,{open:t,onClose:a,PaperProps:{sx:{borderRadius:"12px",maxWidth:"lg"}},children:[(0,n.jsx)(o.Z,{sx:{bgcolor:"primary.main",color:"white",pb:2},children:"Create New Character"}),(0,n.jsxs)(i.Z,{sx:{pt:2},children:[(0,n.jsx)(c.Z,{label:"Name",fullWidth:!0,margin:"dense",value:h,onChange:e=>x(e.target.value),variant:"outlined"}),(0,n.jsx)(c.Z,{label:"Personality",fullWidth:!0,margin:"dense",value:y,onChange:e=>f(e.target.value),variant:"outlined"}),(0,n.jsx)(c.Z,{label:"Interests",fullWidth:!0,margin:"dense",value:b,onChange:e=>Z(e.target.value),variant:"outlined"}),(0,n.jsx)(c.Z,{label:"Backstory (Optional)",fullWidth:!0,margin:"dense",multiline:!0,rows:4,value:C,onChange:e=>k(e.target.value),variant:"outlined"}),(0,n.jsx)(m.Z,{sx:{mt:2},children:"Character Image"}),(0,n.jsx)(p.Z,{type:"file",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){let e=new FileReader;e.onloadend=()=>{w(e.result)},e.readAsDataURL(a)}},sx:{mt:1}}),S&&(0,n.jsx)(j.Z,{sx:{mt:2},children:(0,n.jsx)(v.ZP,{crop:I,onChange:e=>P(e),onComplete:e=>E(e),aspect:1,children:(0,n.jsx)("img",{ref:O,src:S,alt:"Crop preview",style:{maxHeight:"400px"}})})})]}),(0,n.jsxs)(d.Z,{sx:{p:2},children:[(0,n.jsx)(u.Z,{onClick:a,color:"secondary",children:"Cancel"}),(0,n.jsx)(u.Z,{onClick:W,variant:"contained",children:"Save"})]})]})},f=a(9832),b=a(6207),Z=a(5319),C=a(6672),k=a(6202),S=a(1548),w=e=>{let{character:t,apiKey:a,initialMessages:l,onSaveMessages:s,onResetConversation:o,onBack:i}=e,[d,h]=(0,r.useState)(l),[x,g]=(0,r.useState)("");(0,r.useEffect)(()=>{h(l)},[l]);let p=async()=>{if(x.trim()){let e=[...d,{author:"user",content:x}];h(e),g("");try{let n=new S.$D(a).getGenerativeModel({model:"gemini-2.0-flash"}),r="You are ".concat(t.name,". Your personality is: ").concat(t.personality,". Your interests are: ").concat(t.interests,". ").concat(t.backstory?"Your backstory is: ".concat(t.backstory):""," You are talking to a user. Respond in character.");e.slice(-10).forEach(e=>{"user"===e.author?r+="\n\nUser: ".concat(e.content):r+="\n\n".concat(t.name,": ").concat(e.content)}),r+="\n\n".concat(t.name,":");let l=await n.generateContent(r),o=(await l.response).text(),i=[...e,{author:"bot",content:o}];h(i),s(i)}catch(t){console.error("Failed to generate response:",t),h([...e,{author:"bot",content:"Sorry, something went wrong. Please check your API key and try again."}])}}};return(0,n.jsxs)(j.Z,{sx:{display:"flex",flexDirection:"column",height:"100dvh",backgroundImage:"url(".concat(t.backgroundImage,")"),backgroundSize:"cover",backgroundPosition:"center"},children:[(0,n.jsxs)(j.Z,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:1,borderColor:"divider",bgcolor:"rgba(0, 0, 0, 0.5)"},children:[i&&(0,n.jsx)(f.Z,{onClick:i,color:"inherit",sx:{display:{xs:"block",md:"none"}},children:(0,n.jsx)(Z.Z,{})}),(0,n.jsx)(m.Z,{variant:"h6",color:"white",sx:{flexGrow:1,textAlign:"center"},children:t.name}),(0,n.jsx)(f.Z,{onClick:o,color:"inherit",children:(0,n.jsx)(C.Z,{})})]}),(0,n.jsx)(j.Z,{sx:{flexGrow:1,overflowY:"auto",p:2,bgcolor:"rgba(0, 0, 0, 0.5)"},children:d.map((e,t)=>(0,n.jsx)(j.Z,{sx:{display:"flex",justifyContent:"user"===e.author?"flex-end":"flex-start",my:1},children:(0,n.jsx)(b.Z,{sx:{p:1.5,bgcolor:"user"===e.author?"primary.main":"background.paper",maxWidth:"70%",borderRadius:"20px",boxShadow:3,opacity:.9},children:(0,n.jsx)(k.UG,{children:e.content})})},t))}),(0,n.jsxs)(j.Z,{sx:{p:2,display:"flex",bgcolor:"rgba(0, 0, 0, 0.5)"},children:[(0,n.jsx)(c.Z,{fullWidth:!0,value:x,onChange:e=>g(e.target.value),placeholder:"Type a message...",onKeyPress:e=>"Enter"===e.key&&p()}),(0,n.jsx)(u.Z,{onClick:p,variant:"contained",sx:{ml:1},children:"Send"})]})]})},I=a(5273),P=a(7644),N=a(6228),E=a(2088),O=a(4456),R=()=>{let{apiKey:e,isApiKeyModalOpen:t,saveApiKey:a,setApiKeyModalOpen:s}=l(),{characters:o,selectedCharacter:i,conversations:c,saveCharacter:d,selectCharacter:g,saveMessages:p,resetConversation:v,deleteCharacter:b}=x(),[Z,k]=(0,r.useState)(!1),S=(0,r.useCallback)(e=>{i&&p(i.id,e)},[i,p]),R=(0,r.useCallback)(()=>{i&&v(i.id)},[i,v]),W=e=>{window.confirm("Are you sure you want to delete this character?")&&b(e)};return e?(0,n.jsxs)(j.Z,{sx:{display:"flex",height:"100dvh"},children:[(0,n.jsxs)(j.Z,{sx:{width:{xs:"100%",md:"25%"},borderRight:{md:1},borderColor:"divider",display:{xs:i?"none":"block",md:"block"},bgcolor:"background.paper"},children:[(0,n.jsx)(u.Z,{variant:"contained",onClick:()=>k(!0),sx:{m:1,mb:2,width:"calc(100% - 16px)"},children:"New Character"}),(0,n.jsx)(I.Z,{children:o.map(e=>(0,n.jsxs)(P.ZP,{sx:{bgcolor:(null==i?void 0:i.id)===e.id?"primary.dark":"transparent","&:hover":{bgcolor:"primary.light"}},children:[(0,n.jsxs)(j.Z,{sx:{display:"flex",alignItems:"center",width:"100%",cursor:"pointer"},onClick:()=>g(e.id),children:[(0,n.jsx)(N.Z,{children:(0,n.jsx)(E.Z,{src:e.profilePicture||e.backgroundImage})}),(0,n.jsx)(O.Z,{primary:e.name})]}),(0,n.jsx)(f.Z,{onClick:()=>W(e.id),size:"small",children:(0,n.jsx)(C.Z,{})})]},e.id))})]}),(0,n.jsx)(j.Z,{sx:{flexGrow:1,display:{xs:i?"block":"none",md:"block"}},children:i?(0,n.jsx)(w,{character:i,apiKey:e,initialMessages:c[i.id]||[],onSaveMessages:S,onResetConversation:R,onBack:()=>g(null)}):(0,n.jsx)(j.Z,{sx:{p:2,textAlign:"center",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,n.jsx)(m.Z,{variant:"h6",color:"text.secondary",children:"Select a character to start chatting or create a new one."})})}),(0,n.jsx)(y,{open:Z,onClose:()=>k(!1),onSave:e=>{d(e),k(!1)}})]}):(0,n.jsx)(h,{open:t,onClose:()=>s(!1),onSave:a})}}},function(e){e.O(0,[558,807,657,971,117,744],function(){return e(e.s=1801)}),_N_E=e.O()}]);